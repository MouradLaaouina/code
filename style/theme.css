/*
  Thème global clair/sombre automatique
  - Définit les variables CSS pour les couleurs et ombres
  - S’adapte à prefers-color-scheme et à body.dark
  - Expose --navH et --nav-offset pour compenser la barre de navigation
  - Respecte les préférences de réduction d’animations
*/

/* Base variables (light by default) */
:root {
  color-scheme: light dark;
  --bg: #e9f0ea;
  --text: #1a3a1d;
  --muted: #5a7a5e;
  --card: #ffffff;
  --cta: #2f6b2f;
  --cta-hover: #255825;
  --border: #ecf0ed;
  --shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
  /* Hauteur par défaut du nav (fallback si JS inactif) */
  --navH: 60px;
  /* Zone sûre pour encoches (iOS) */
  --safe-top: env(safe-area-inset-top);
  /* Offset additionnel entre le nav et le contenu (modifiable site-wide) */
  --nav-offset: 8px;
}

/* Auto dark via system preference */
@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0f1f0f;
    --text: #e8f5ee;
    --muted: #b7d0c1;
    --card: #16251a;
    --cta: #2f6b2f; /* keep brand */
    --cta-hover: #3a8a3a;
    --border: #26382e;
    --shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
  }
}

/* Also support manual toggle using body.dark (from navigation) */
body.dark, .dark {
  --bg: #0f1f0f;
  --text: #e8f5ee;
  --muted: #b7d0c1;
  --card: #16251a;
  --cta: #2f6b2f;
  --cta-hover: #3a8a3a;
  --border: #26382e;
  --shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
}

/* Apply variables to page baseline */
html { scroll-behavior: smooth; }
body { background: var(--bg); color: var(--text); }

/* Fallback pratique: si besoin d'un réglage via CSS uniquement,
   décommentez la ligne suivante pour forcer un padding global basé sur --navH */
/* body { padding-top: calc(var(--navH, 60px) + var(--nav-offset)); } */

/* Sécurité encoches: ajoute l'aire sûre au padding-top du nav
   (remplace py-4 top sans affecter le bottom) */
nav.nav {
  padding-top: calc(0.25rem + var(--safe-top, 0px));
  padding-bottom: 0.25rem;
  /* Fond doré brillant + brillance */
  background-image:
    linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.45) 45%, rgba(255,255,255,0) 70%),
    linear-gradient(135deg, #B8860B 0%, #D4AF37 22%, #FFD700 45%, #FFF1A8 60%, #FFC94D 78%, #B98900 100%);
  background-size: 200% 100%, 100% 100%;
  background-position: -150% 0, 0 0;
  background-repeat: no-repeat;
  animation: navShimmer 6s linear infinite;
}

@keyframes navShimmer {
  0% { background-position: -150% 0, 0 0; }
  100% { background-position: 150% 0, 0 0; }
}

@media (prefers-reduced-motion: reduce) {
  nav.nav { animation: none; background-size: 100% 100%, 100% 100%; background-position: 0 0, 0 0; }
}

/* Décalage d'ancrage pour éviter que le nav ne masque les sections ciblées */
[id] { scroll-margin-top: calc(var(--navH, 60px) + var(--nav-offset, 8px)); }

/* Common component tweaks to honor theme */
.kpi-card { background: var(--card) !important; color: var(--text); }
.marquee { background: var(--card) !important; }
#lightbox-content { background: var(--card) !important; color: var(--text) !important; }

/* Links inside dark cards */
a { color: inherit; }

/* Tailwind helpers when body has .dark (manual/system via navigation) */
.dark .text-gray-900,
.dark .text-gray-800,
.dark .text-gray-700 { color: var(--text) !important; }

.dark .text-gray-600,
.dark .text-gray-500,
.dark .text-gray-400 { color: var(--muted) !important; }

.dark .bg-white,
.dark .bg-gray-50,
.dark .bg-gray-100,

.dark .border-gray-100,
.dark .border-gray-200,
.dark .border-gray-300 { border-color: var(--border) !important; }

.dark .text-black { color: var(--text) !important; }

/* Tuning of brand greens for readability on dark */
.dark .text-green-900,
.dark .text-green-800,
.dark .text-green-700 { color: #86efac !important; }

.dark .text-green-600 { color: #a7f3d0 !important; }

/* Navigation: ergonomie mobile/desktop améliorée */
@media (max-width: 767.98px) {
  /* Panneau mobile: hauteur max sous la barre, scroll si contenu long */
  #primary-nav {
    max-height: calc(100vh - var(--navH, 60px) - var(--safe-top, 0px));
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  /* Sous-menus en accordéon: sans position absolue, transitions douces */
  .nav .has-submenu > .submenu {
    position: static !important;
    box-shadow: none !important;
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-top: 8px;
    padding: 4px 0;
    transform: none !important;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.25s ease, opacity 0.2s ease;
    background: var(--card);
  }
  .nav .has-submenu > [data-submenu-toggle][aria-expanded="true"] + .submenu {
    opacity: 1;
    max-height: 600px;
  }
  .nav .submenu a { padding: 10px 16px; display: block; }
}

/* Backdrop lors de l’ouverture du menu mobile */
.nav-backdrop {
  position: fixed;
  top: var(--navH, 60px);
  left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.35);
  backdrop-filter: saturate(120%) blur(2px);
  z-index: 40; /* sous nav (z-50) mais au-dessus du contenu */
}

/* ------- Dark Mode Readability (global) ------- */
/* Ensure consistent contrast for pages with custom colors */
.dark body { background: var(--bg); color: var(--text); }
.dark h1, .dark h2, .dark h3, .dark h4, .dark h5, .dark h6 { color: var(--text) !important; }
.dark p, .dark li, .dark dt, .dark dd, .dark blockquote, .dark figcaption, .dark time, .dark small, .dark label { color: var(--text) !important; }
.dark a { color: var(--text) !important; }

/* Media tuning on dark surfaces (subtle) */
.dark img:not([data-keep-bright]),
.dark video:not([data-keep-bright]) { filter: brightness(0.98) contrast(1.03); }

/* Utilities for special assets */
.dark .invert-on-dark { filter: invert(1) hue-rotate(180deg); }
.dark .dim-on-dark { filter: brightness(0.88) contrast(1.08); }

/* SVG defaults: inherit text color */
.dark svg { color: var(--text); }
